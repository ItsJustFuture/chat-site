<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Chat Site</title>
  <link rel="stylesheet" href="/styles.css">
</head>

<body>
  <!-- AUTH -->
  <div id="authWrap">
    <div class="authCard">
      <div class="authTitle">Login / Register</div>

      <div class="field">
        <label>Username</label>
        <input id="authUser" autocomplete="username" placeholder="username">
      </div>

      <div class="field">
        <label>Password</label>
        <input id="authPass" type="password" autocomplete="current-password" placeholder="password">
      </div>

      <div class="row">
        <button class="btn" id="loginBtn" type="button">Login</button>
        <button class="btn secondary" id="regBtn" type="button">Register</button>
      </div>

      <div class="msgline" id="authMsg"></div>
    </div>
  </div>

  <!-- APP -->
  <div id="app">
    <div class="layout">
      <aside class="channels" id="channelsPane">
       <div class="brand">
  <strong>Chat Site</strong>
  <div class="small" id="nowRoom">main</div>
</div>

<div class="chanHeader">
  <div class="small">Rooms</div>
  <button class="iconBtn smallIcon" id="addRoomBtn" type="button" title="Create room">Ôºã</button>
</div>

<div class="chanList" id="chanList">
  <!-- will be rendered by app.js from /rooms -->
</div>

        <div class="bottomBar">
          <div class="meRow">
            <div class="meLeft">
              <div class="meAvatar" id="meAvatar"></div>
              <div class="meMeta">
                <div class="meName" id="meName">...</div>
                <div class="meRole" id="meRole">...</div>
              </div>
            </div>

            <div class="row" style="gap:8px; align-items:center;">
              <div class="meStatusText" id="meStatusText">Online</div>
              <button class="iconBtn" id="profileBtn" type="button" title="Profile">üë§</button>
            </div>
          </div>

          <select id="statusSelect">
            <option>Online</option>
            <option>Away</option>
            <option>Busy</option>
            <option>Do Not Disturb</option>
            <option>Idle</option>
            <option>Gaming</option>
            <option>Listening to Music</option>
            <option>Working</option>
            <option>Looking to Chat</option>
            <option>Invisible</option>
          </select>
        </div>
      </aside>

      <main class="chat">
        <div class="topbar">
          <div class="row" style="align-items:center; gap:10px;">
            <button class="iconBtn mobOnly" id="openChannelsBtn" type="button" title="Channels">‚ò∞</button>
           <div class="roomTitle"><span id="roomTitle">main</span></div>
          </div>

            <div class="row" style="align-items:center; gap:10px;">
            <div class="searchWrap">
              <input id="searchInput" placeholder="Search messages...">
            </div>
            <button class="iconBtn withBadge" id="dmToggleBtn" type="button" title="Direct messages">üí¨<span class="notifDot" id="dmBadgeDot" title="New DMs"></span></button>
            <button class="iconBtn withBadge" id="groupDmToggleBtn" type="button" title="Group chats">üë™<span class="notifDot right" id="groupDmBadgeDot" title="New group DMs"></span></button>
            <button class="iconBtn mobOnly" id="openMembersBtn" type="button" title="Members">üë•</button>
          </div>
        </div>

        <div class="msgs" id="msgs"></div>
        <div class="typing" id="typing"></div>

        <div id="uploadPreview" class="uploadPreview">
          <div class="uploadLeft">
            <div id="previewThumb" class="previewThumb"></div>
            <div class="uploadMeta">
              <div id="uploadName" class="uploadName"></div>
              <div id="uploadInfo" class="uploadInfo"></div>
            </div>
          </div>
          <div class="uploadRight">
            <div class="progressWrap">
              <div id="uploadProgress" class="progressBar"></div>
            </div>
            <button class="btn secondary" id="cancelUploadBtn" type="button">Cancel</button>
          </div>
        </div>

        <div class="inputBar">
         <input id="msgInput" type="text" placeholder="Message main" maxlength="800">

          <!-- hidden native input -->
          <input id="fileInput" type="file" accept="image/*,video/mp4,video/quicktime">

          <!-- camera icon button -->
          <button class="iconBtn" id="pickFileBtn" type="button" title="Upload">üì∑</button>

          <button class="btn" id="sendBtn" type="button">Send</button>
        </div>
      </main>

      <aside class="members drawer" id="membersPane">
        <h3>Members</h3>
        <div id="memberList"></div>
        <div id="memberMenu" class="memberMenu">
          <div class="memberMenuHeader">
            <div class="memberMenuName" id="memberMenuName"></div>
            <div class="small" id="memberMenuHint">Quick actions</div>
          </div>
          <div class="memberMenuActions">
            <button class="btn secondary" id="memberViewProfileBtn" type="button">View profile</button>
            <button class="btn" id="memberDmBtn" type="button">DM</button>
          </div>
        </div>
      </aside>
    </div>
  </div>

  <!-- Mobile overlay -->
  <div id="drawerOverlay" class="overlay"></div>

  <!-- DM PANEL -->
  <div id="dmPanel" class="dmPanel">
    <div class="dmHeader">
      <div>
        <div class="title">Direct Messages</div>
        <div class="small">Start a DM from the members list or create a quick group.</div>
      </div>
      <div class="row" style="gap:6px;">
        <button class="iconBtn secondary" id="dmAddUserBtn" type="button" title="Add user to DM">‚ûï</button>
        <button class="iconBtn" id="dmCloseBtn" type="button" title="Close">‚úï</button>
      </div>
    </div>

    <div class="dmCreate">
      <div class="dmCreateTop">
        <div class="small" id="dmModeLabel">Mode: Direct Message</div>
        <div class="dmModeSwitch">
          <button class="chip active" id="dmDirectModeBtn" type="button">Direct</button>
          <button class="chip" id="dmGroupModeBtn" type="button">Group</button>
        </div>
      </div>
      <div class="dmHelper" id="dmDirectHelper">Click a name in Members to open a DM instantly. We only save it after the first message.</div>
      <div class="dmHelper group" id="dmGroupHelper">Invite multiple people or give your group a title to get started.</div>
      <div class="dmInputs" id="dmInputs">
        <div class="dmParticipantsRow" id="dmParticipantsRow">
          <input id="dmParticipants" placeholder="Add people (comma separated)">
        </div>
        <div class="dmTitleRow" id="dmTitleRow">
          <input id="dmTitle" placeholder="Group title (optional)">
        </div>
      </div>
      <div class="dmActions">
        <button class="btn" id="dmCreateBtn" type="button">Start chat</button>
        <div class="msgline" id="dmMsg"></div>
      </div>
    </div>

    <div class="dmContent">
      <div class="dmThreads" id="dmThreadList"></div>
      <div class="dmConversation">
        <div class="dmMeta">
          <div class="dmMetaText">
            <div class="title" id="dmMetaTitle">Pick a thread</div>
            <div class="small" id="dmMetaPeople"></div>
          </div>
          <div class="dmMetaActions">
            <button class="iconBtn secondary" id="dmSettingsBtn" type="button" title="DM settings">‚öôÔ∏è</button>
            <div class="dmSettingsMenu" id="dmSettingsMenu">
              <div class="dmSettingsRow">
                <button class="btn danger" id="dmDeleteHistoryBtn" type="button">Delete history</button>
                <div class="small">Remove every message in this DM for all participants.</div>
              </div>
              <div class="dmSettingsRow">
                <div class="small">DM background</div>
                <div class="colorInputRow tight">
                  <input id="dmBgColor" type="color" aria-label="DM background color">
                  <input id="dmBgColorText" type="text" placeholder="#1e1f22 or blue" aria-label="DM background color text">
                </div>
                <div class="small">Change the backdrop behind your DM threads and conversation.</div>
              </div>
              <div class="dmSettingsRow">
                <button class="btn secondary" id="dmReportBtn" type="button">Report DM (coming soon)</button>
              </div>
            </div>
          </div>
        </div>
        <div class="dmMessages" id="dmMessages"></div>
        <div class="dmInput">
          <input id="dmText" placeholder="Message" maxlength="800">
          <button class="btn" id="dmSendBtn" type="button">Send</button>
        </div>
      </div>
    </div>
  </div>

  <!-- PROFILE / MODAL -->
  <div id="modal">
    <div class="modalCard">
      <div class="modalTop">
        <strong id="modalTitle">Profile</strong>
        <button class="btn secondary" id="closeModalBtn" type="button">Close</button>
      </div>

      <div class="small" id="modalMeta"></div>

      <div class="tabs" id="tabs">
        <div class="tab active" data-tab="info" id="tabInfo">Info</div>
        <div class="tab" data-tab="about" id="tabAbout">About</div>
        <div class="tab" data-tab="customize" id="tabCustomize">Customization</div>
        <div class="tab" data-tab="moderation" id="tabModeration" style="display:none;">Moderation</div>
      </div>

      <div id="viewInfo">
        <div class="modalGrid">
          <div>
            <div class="pAvatar" id="modalAvatar"></div>
          </div>

          <div>
            <div class="row" style="align-items:center;">
              <div style="font-weight:900; font-size:16px;" id="modalName"></div>
              <div class="badge" id="modalRole"></div>
            </div>
            <div class="small" id="modalMood"></div>

            <div class="sectionTitle">Details</div>
            <div class="infoGrid">
              <div class="infoItem"><div class="k">Age</div><div class="v" id="infoAge">‚Äî</div></div>
              <div class="infoItem"><div class="k">Gender</div><div class="v" id="infoGender">‚Äî</div></div>
              <div class="infoItem"><div class="k">Created</div><div class="v" id="infoCreated">‚Äî</div></div>
              <div class="infoItem"><div class="k">Last seen</div><div class="v" id="infoLastSeen">‚Äî</div></div>
              <div class="infoItem"><div class="k">Current room</div><div class="v" id="infoRoom">‚Äî</div></div>
              <div class="infoItem"><div class="k">Status</div><div class="v" id="infoStatus">‚Äî</div></div>
            </div>

            <div class="row" style="gap:8px; margin-top:10px; flex-wrap:wrap;">
              <button class="btn secondary" id="dmUserBtn" type="button">Message</button>
              <button class="btn secondary" id="copyUsernameBtn" type="button">Copy username</button>
              <button class="btn secondary" id="copyProfileLinkBtn" type="button">Copy profile link</button>
            </div>
            <div class="msgline" id="mediaMsg"></div>

            <div id="myProfileEdit" style="display:none; margin-top:12px;">
              <div class="sectionTitle">Edit my profile</div>
              <div class="panelBox">
                <div class="field">
                  <label>Avatar</label>
                  <input id="avatarFile" type="file" accept="image/*">
                  <div class="small">Max 2MB. PNG/JPG/WEBP/GIF.</div>
                </div>

                <div class="field">
                  <label>Mood</label>
                  <input id="editMood" placeholder="e.g. chilling">
                </div>

                <div class="row">
                  <div class="field" style="flex:1;">
                    <label>Age (18+)</label>
                    <input id="editAge" type="number" min="18" max="120" placeholder="18+">
                  </div>
                  <div class="field" style="flex:1;">
                    <label>Gender</label>
                    <select id="editGender">
                      <option value="">Prefer not to say</option>
                      <option value="Male">Male</option>
                      <option value="Female">Female</option>
                      <option value="Non-binary">Non-binary</option>
                      <option value="Transgender">Transgender</option>
                      <option value="Genderfluid">Genderfluid</option>
                      <option value="Agender">Agender</option>
                      <option value="Other">Other</option>
                    </select>
                  </div>
                </div>

                <div class="field">
                  <label>Bio (BBCode supported)</label>
                  <textarea id="editBio" placeholder="[b]bold[/b] [i]italics[/i] [url=https://...]link[/url] [quote]...[/quote]"></textarea>
                </div>

                <div class="row">
                  <button class="btn" id="saveProfileBtn" type="button">Save</button>
                  <button class="btn secondary" id="refreshProfileBtn" type="button">Refresh</button>
                  <button class="btn danger" id="logoutBtn" type="button">Logout</button>
                </div>

                <div class="msgline" id="profileMsg"></div>
              </div>
            </div>

            <div id="memberModTools" style="display:none; margin-top:12px;">
              <div class="sectionTitle">Moderator tools</div>
              <div class="panelBox">
                <div class="row" style="align-items:center;">
                  <input id="quickReason" placeholder="Reason (required)" style="flex:1; min-width:220px;">
                  <input id="quickMuteMins" type="number" min="1" max="1440" placeholder="mute mins" style="width:120px;">
                  <input id="quickBanMins" type="number" min="0" max="999999" placeholder="ban mins (0=perm)" style="width:160px;">
                </div>
                <div class="row" style="margin-top:8px;">
                  <button class="btn secondary" id="quickKickBtn" type="button">Kick</button>
                  <button class="btn secondary" id="quickMuteBtn" type="button">Mute</button>
                  <button class="btn danger" id="quickBanBtn" type="button">Ban</button>
                </div>
                <div class="msgline" id="quickModMsg"></div>
              </div>
            </div>

          </div>
        </div>
      </div>

      <div id="viewAbout" style="display:none;">
        <div class="sectionTitle">Bio</div>
        <div class="bioRender" id="bioRender">(no bio)</div>
        <div class="small" style="margin-top:8px;">
          BBCode: [b] [i] [u] [s] [quote] [code] [url=] [img]
        </div>
      </div>

      <div id="viewCustomize" style="display:none;">
        <div class="sectionTitle">Customization</div>
        <div class="panelBox">
          <div class="field">
            <label>Direct message badge color</label>
            <div class="colorInputRow">
              <input id="directBadgeColor" type="color" aria-label="Direct message badge color">
              <input id="directBadgeColorText" type="text" placeholder="#ed4245 or red" aria-label="Direct message badge color text">
            </div>
          </div>

          <div class="field">
            <label>Group DM badge color</label>
            <div class="colorInputRow">
              <input id="groupBadgeColor" type="color" aria-label="Group DM badge color">
              <input id="groupBadgeColorText" type="text" placeholder="#5865f2 or blue" aria-label="Group DM badge color text">
            </div>
          </div>

          <div class="row" style="margin-top:6px;">
            <button class="btn" id="saveBadgePrefsBtn" type="button">Save badge colors</button>
          </div>

          <div class="msgline" id="customizeMsg"></div>
        </div>
      </div>

      <div id="viewModeration" style="display:none;">
        <div class="sectionTitle">Moderation panel</div>

        <div class="panelBox">
          <div class="row" style="align-items:center;">
            <input id="modUser" placeholder="Target username" style="flex:1; min-width:220px;">
            <input id="modReason" placeholder="Reason (required)" style="flex:2; min-width:240px;">
          </div>

          <div class="row" style="align-items:center; margin-top:8px;">
            <input id="modMuteMins" type="number" min="1" max="1440" placeholder="mute mins" style="width:140px;">
            <input id="modBanMins" type="number" min="0" max="999999" placeholder="ban mins (0=perm)" style="width:190px;">

            <button class="btn secondary" id="modKickBtn" type="button">Kick</button>
            <button class="btn secondary" id="modMuteBtn" type="button">Mute</button>
            <button class="btn danger" id="modBanBtn" type="button">Ban</button>

            <button class="btn secondary" id="modUnmuteBtn" type="button">Unmute</button>
            <button class="btn secondary" id="modUnbanBtn" type="button">Unban</button>
            <button class="btn secondary" id="modWarnBtn" type="button">Warn</button>

            <button class="btn secondary" id="modOpenProfileBtn" type="button">View profile</button>
          </div>

          <div class="row" style="align-items:center; margin-top:10px;">
            <select id="modSetRole" style="width:220px;">
              <option value="">Set role (Owner only)</option>
              <option>Owner</option>
              <option>Co-owner</option>
              <option>Admin</option>
              <option>Moderator</option>
              <option>VIP</option>
              <option>User</option>
              <option>Guest</option>
            </select>
            <button class="btn secondary" id="modSetRoleBtn" type="button">Apply role</button>
          </div>

          <div class="msgline" id="modMsg"></div>
        </div>

        <div class="sectionTitle">Moderation logs</div>
        <div class="panelBox">
          <div class="row" style="align-items:center;">
            <input id="logUser" placeholder="Filter by user (actor or target)" style="flex:1; min-width:220px;">
            <select id="logAction" style="width:220px;">
              <option value="">All actions</option>
              <option value="KICK">KICK</option>
              <option value="MUTE">MUTE</option>
              <option value="BAN">BAN</option>
              <option value="DELETE_MESSAGE">DELETE_MESSAGE</option>
              <option value="UNMUTE">UNMUTE</option>
              <option value="UNBAN">UNBAN</option>
              <option value="WARN">WARN</option>
              <option value="SET_ROLE">SET_ROLE</option>
            </select>
            <select id="logLimit" style="width:160px;">
              <option value="25">Last 25</option>
              <option value="50" selected>Last 50</option>
              <option value="100">Last 100</option>
              <option value="200">Last 200</option>
            </select>
            <button class="btn secondary" id="refreshLogsBtn" type="button">Refresh</button>
          </div>

          <div class="msgline" id="logsMsg"></div>

          <div style="overflow:auto; margin-top:8px;">
            <table class="logTable">
              <thead>
                <tr>
                  <th>Time</th>
                  <th>Actor</th>
                  <th>Action</th>
                  <th>Target</th>
                  <th>Room</th>
                  <th>Details</th>
                </tr>
              </thead>
              <tbody id="logsBody"></tbody>
            </table>
          </div>
        </div>
      </div>

    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script src="/app.js" defer></script>
</body>
</html>
